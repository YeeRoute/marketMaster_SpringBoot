<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <title>商品資料</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../../static/CSS/style.css">
</head>

<body>
    <div class="container">
        <select name="size" id="size">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="30">30</option>

        </select>

        <table id="productTable" class="table table-striped">
            <thead class="table-dark">
                <tr>
                    <th>商品編號</th>
                    <th>商品類別名稱</th>
                    <th>商品名稱</th>
                    <th>商品售價</th>
                    <th>安全庫存量</th>
                    <th>上架數量</th>
                    <th>庫存數量</th>
                    <th>銷售數量</th>
                    <th>兌換數量</th>
                    <th>銷毀數量</th>
                    <th>下架數量</th>
                    <th>修改</th>
                    <th>上架</th>
                    <th>下架</th>
                </tr>
            </thead>
            <tbody>
                <th:block th:each="product:${products.content}">

                    <tr>
                        <td th:text="${product.productId}"></td>
                        <td th:text="${product.productCategory}"></td>
                        <td><a th:text="${product.productName}"
                                href="${pageContext.request.contextPath}/getOneProduct?productId=${product.productId}"></a>
                        </td>
                        <td th:text="${product.productPrice}"></td>
                        <td th:text="${product.productSafeInventory}"></td>
                        <td th:text="${product.numberOfShelve}"></td>
                        <td th:text="${product.numberOfInventory}" data-safe-inventory="${product.productSafeInventory}"
                            class="inventory"></td>
                        <td th:text="${product.numberOfSale}"></td>
                        <td th:text="${product.numberOfExchange}"></td>
                        <td th:text="${product.numberOfDestruction}"></td>
                        <td th:text="${product.numberOfRemove}"></td>
                        <td>
                            <form method="post" action="${pageContext.request.contextPath}/getUpdateProduct"
                                class="d-inline">
                                <input type="hidden" name="action" value="GetUpdateProduct">
                                <input type="hidden" name="productId" value=${product.productId }>
                                <button type="submit" class="btn btn-secondary">修改</button>
                            </form>
                        </td>
                        <td>
                            <form action="${pageContext.request.contextPath}/getShelveProduct" method="post"
                                class="d-inline">
                                <input type="hidden" name="action" value="GetShelveProduct">
                                <input type="hidden" name="productId" value="${product.productId}">
                                <button type="submit" class="btn btn-warning">上架</button>
                            </form>
                        </td>
                        <td>
                            <form action="${pageContext.request.contextPath}/removeProduct" method="post"
                                class="d-inline">
                                <input type="hidden" name="action" value="RemoveProduct">
                                <input type="hidden" name="productId" value="${product.productId}">
                                <button type="button" class="btn btn-danger" id="remove">下架</button>
                            </form>
                        </td>
                    </tr>
                </th:block>
            </tbody>
        </table>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const size = document.getElementById("size");
            const productTable = document.getElementById("productTable");

            size.addEventListener("change", function () {
                const pageSize = size.value;

                axios.get('http://localhost:8080/product/findAll/json', {
                    params: {
                        size: pageSize,
                        page: 1  // You might want to keep track of the current page as well
                    }
                })
                    .then(response => {
                        const products = response.data.content;
                        updateTable(products);
                    })
                    .catch(err => {
                        console.error('Error fetching data:', err);
                    });
            });

            function updateTable(products) {
                const tbody = productTable.querySelector('tbody');
                tbody.innerHTML = ''; // Clear existing rows

                products.forEach(product => {
                    const row = `
                <tr>
                    <td>${product.productId}</td>
                    <td>${product.productCategory}</td>
                    <td><a href="/getOneProduct?productId=${product.productId}">${product.productName}</a></td>
                    <td>${product.productPrice}</td>
                    <td>${product.productSafeInventory}</td>
                    <td>${product.numberOfShelve}</td>
                    <td class="inventory" data-safe-inventory="${product.productSafeInventory}">${product.numberOfInventory}</td>
                    <td>${product.numberOfSale}</td>
                    <td>${product.numberOfExchange}</td>
                    <td>${product.numberOfDestruction}</td>
                    <td>${product.numberOfRemove}</td>
                    <td>
                        <form method="post" action="/getUpdateProduct" class="d-inline">
                            <input type="hidden" name="action" value="GetUpdateProduct">
                            <input type="hidden" name="productId" value="${product.productId}">
                            <button type="submit" class="btn btn-secondary">修改</button>
                        </form>
                    </td>
                    <td>
                        <form action="/getShelveProduct" method="post" class="d-inline">
                            <input type="hidden" name="action" value="GetShelveProduct">
                            <input type="hidden" name="productId" value="${product.productId}">
                            <button type="submit" class="btn btn-warning">上架</button>
                        </form>
                    </td>
                    <td>
                        <form action="/removeProduct" method="post" class="d-inline">
                            <input type="hidden" name="action" value="RemoveProduct">
                            <input type="hidden" name="productId" value="${product.productId}">
                            <button type="button" class="btn btn-danger" id="remove">下架</button>
                        </form>
                    </td>
                </tr>
            `;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
            }
        });
    </script>

</body>

</html>